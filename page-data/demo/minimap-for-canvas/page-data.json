{"componentChunkName":"component---src-templates-demo-jsx","path":"/demo/minimap-for-canvas","result":{"data":{"demoPage":{"html":"<p>This tutorial is still a work in progress.\nThis tutorial show some concepts on how to build a minimap for a large canvas.</p>\n<p>The main thing to take in account is to display the same set of objects on 2 different canvas with 2 different size and zoom level. To do this we will render the whole design as an image and use it as background in the minimap.</p>\n<p>This is a cache killer, so we will disable the <code class=\"language-text\">objectCaching</code> for this example, as of today there is not really a codepath that lets you draw object at 2 zoom level and keep the cache alive.</p>\n<p>We will add on the minimap a rect that will be our indicator of the viewport.</p>\n<h2 id=\"setting-up-the-idea\" style=\"position:relative;\">Setting up the idea<a href=\"#setting-up-the-idea\" aria-label=\"setting up the idea permalink\" class=\"anchor after\"></a></h2>\n<p>We are going to create to canvases, on purposes both with a different aspect ratio and both different from the design aspect ratio.</p>\n<p>The small one for the minimap will be positioned on top of the bigger one.</p>\n<p>The inputs on the small one will generate events to manipulate the zoom on the bigger one.</p>\n<div\n  class=\"codepen-later\"\n  data-editable=\"true\"\n  data-height=\"500\"\n  data-default-tab=\"result\"\n  data-prefill='{\n    \"scripts\": [\"https://unpkg.com/fabric@4.0.0-beta.12/dist/fabric.js\", \"https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.15/lodash.js\"]\n  }'\n>\n<pre data-lang=\"css\" data-options-autoprefixer=\"true\">\n  .minimap {\n  \tborder: 1px solid blue;\n    position: absolute !important;\n    top: 20px;\n    left: 20px;\n  }\n  .design {\n    border: 1px solid black;\n  }\n</pre>\n<pre data-lang=\"html\">\n  <canvas id=\"design\" width=\"500\" height=\"400\" ></canvas>\n  <canvas id=\"minimap\" width=\"130\" height=\"130\" style=\"position: absolute; top: 10px; left: 10px;\"></canvas>\n</pre>\n<pre data-lang=\"js\">\n<p>  fabric.Object.prototype.objectCaching = false;</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">var design = new fabric.Canvas(&#39;design&#39;, { containerClass: &#39;design&#39; });</code></pre></div>\n<p>  var minimap = new fabric.Canvas('minimap',  { containerClass: 'minimap', selection: false });</p>\n<p>  design.loadFromJSON({\"version\":\"3.6.3\",\"objects\":[{\"type\":\"rect\",\"version\":\"3.6.3\",\"left\":513,\"top\":160,\"width\":50,\"height\":50,\"fill\":\"#8d476b\",\"opacity\":0.8},{\"type\":\"circle\",\"version\":\"3.6.3\",\"left\":174,\"top\":166,\"width\":100,\"height\":100,\"fill\":\"#383881\",\"opacity\":0.8,\"radius\":50,\"startAngle\":0,\"endAngle\":6.283185307179586},{\"type\":\"triangle\",\"version\":\"3.6.3\",\"left\":330,\"top\":242,\"width\":50,\"height\":50,\"fill\":\"#c8eff0\",\"opacity\":0.8},{\"type\":\"line\",\"version\":\"3.6.3\",\"left\":328,\"top\":300,\"width\":150,\"height\":100,\"stroke\":\"#98d727\",\"x1\":-75,\"x2\":75,\"y1\":-50,\"y2\":50},{\"type\":\"polygon\",\"version\":\"3.6.3\",\"left\":44,\"top\":257,\"width\":385,\"height\":245,\"fill\":\"#6aefb4\",\"points\":[{\"x\":185,\"y\":0},{\"x\":250,\"y\":100},{\"x\":385,\"y\":170},{\"x\":0,\"y\":245}]},{\"type\":\"textbox\",\"version\":\"3.6.3\",\"left\":254,\"top\":195,\"width\":300,\"height\":75.03,\"fill\":\"#049c82\",\"angle\":-9,\"text\":\"Lorem ipsum dolor sit amet,\\nconsectetur adipisicing elit,\\nsed do eiusmod tempor \",\"fontSize\":20,\"fontWeight\":\"\",\"fontFamily\":\"helvetica\",\"minWidth\":20,\"splitByGrapheme\":false,\"styles\":{}},{\"type\":\"i-text\",\"version\":\"3.6.3\",\"left\":348,\"top\":326,\"width\":598.13,\"height\":150.06,\"fill\":\"#d15803\",\"scaleX\":0.5,\"scaleY\":0.5,\"angle\":3,\"text\":\"Lorem ipsum dolor sit amet,\\nconsectetur adipisicing elit,\\nsed do eiusmod tempor incididunt\",\"fontWeight\":\"\",\"fontFamily\":\"helvetica\",\"styles\":{}},{\"type\":\"text\",\"version\":\"3.6.3\",\"left\":32,\"top\":438,\"width\":598.13,\"height\":254.93,\"fill\":\"#69c5c5\",\"scaleX\":0.5,\"scaleY\":0.5,\"angle\":4,\"text\":\"Lorem ipsum dolor sit amet,\\nconsectetur adipisicing elit,\\nsed do eiusmod tempor incididunt\\nut labore et dolore magna aliqua.\\nUt enim ad mini\",\"fontWeight\":\"\",\"fontFamily\":\"helvetica\",\"styles\":{}},{\"type\":\"rect\",\"version\":\"3.6.3\",\"left\":175,\"top\":105,\"width\":50,\"height\":50,\"fill\":\"#761c05\",\"opacity\":0.8},{\"type\":\"circle\",\"version\":\"3.6.3\",\"left\":187,\"top\":6,\"width\":100,\"height\":100,\"fill\":\"#360560\",\"opacity\":0.8,\"radius\":50,\"startAngle\":0,\"endAngle\":6.283185307179586},{\"type\":\"triangle\",\"version\":\"3.6.3\",\"left\":284,\"top\":390,\"width\":50,\"height\":50,\"fill\":\"#fe047d\",\"opacity\":0.8},{\"type\":\"line\",\"version\":\"3.6.3\",\"left\":290,\"top\":434,\"width\":150,\"height\":100,\"stroke\":\"#ad7cee\",\"x1\":-75,\"x2\":75,\"y1\":-50,\"y2\":50},{\"type\":\"polygon\",\"version\":\"3.6.3\",\"left\":20,\"top\":249,\"width\":385,\"height\":245,\"fill\":\"#3a41a7\",\"scaleX\":0.55,\"scaleY\":0.55,\"points\":[{\"x\":185,\"y\":0},{\"x\":250,\"y\":100},{\"x\":385,\"y\":170},{\"x\":0,\"y\":245}]},{\"type\":\"textbox\",\"version\":\"3.6.3\",\"left\":269,\"top\":27,\"width\":300,\"height\":153.68,\"fill\":\"#e19e54\",\"angle\":-1,\"text\":\"Lorem ipsum dolor sit amet,\\nconsectetur adipisicing elit,\\nsed do eiusmod tempor incididunt\\nut labore et dolore magna aliqua.\\nUt enim ad minim veniam,\\nquis no\",\"fontSize\":20,\"fontWeight\":\"\",\"fontFamily\":\"helvetica\",\"minWidth\":20,\"splitByGrapheme\":false,\"styles\":{}},{\"type\":\"i-text\",\"version\":\"3.6.3\",\"left\":391,\"top\":296,\"width\":493.52,\"height\":97.63,\"fill\":\"#d63098\",\"scaleX\":0.5,\"scaleY\":0.5,\"angle\":-10,\"text\":\"Lorem ipsum dolor sit amet,\\nconsectetur \",\"fontWeight\":\"\",\"fontFamily\":\"helvetica\",\"styles\":{}},{\"type\":\"text\",\"version\":\"3.6.3\",\"left\":330,\"top\":544,\"width\":371.25,\"height\":45.2,\"fill\":\"#4d690c\",\"scaleX\":0.5,\"scaleY\":0.5,\"angle\":5,\"text\":\"Lorem ipsum dolor si\",\"fontWeight\":\"\",\"fontFamily\":\"helvetica\",\"styles\":{}},{\"type\":\"rect\",\"version\":\"3.6.3\",\"left\":100,\"top\":66,\"width\":50,\"height\":50,\"fill\":\"#1b39bb\",\"opacity\":0.8},{\"type\":\"circle\",\"version\":\"3.6.3\",\"left\":266,\"top\":98,\"width\":100,\"height\":100,\"fill\":\"#4f8af4\",\"opacity\":0.8,\"radius\":50,\"startAngle\":0,\"endAngle\":6.283185307179586},{\"type\":\"triangle\",\"version\":\"3.6.3\",\"left\":119,\"top\":152,\"width\":50,\"height\":50,\"fill\":\"#6d16e6\",\"opacity\":0.8},{\"type\":\"text\",\"version\":\"3.6.3\",\"left\":365,\"top\":237,\"width\":493.52,\"height\":97.63,\"fill\":\"#44c459\",\"scaleX\":0.5,\"scaleY\":0.5,\"angle\":-2,\"text\":\"Lorem ipsum dolor sit amet,\\nconsectet\",\"fontWeight\":\"\",\"fontFamily\":\"helvetica\",\"styles\":{}},{\"type\":\"i-text\",\"version\":\"3.6.3\",\"left\":220.87,\"top\":288.28,\"width\":598.13,\"height\":202.5,\"fill\":\"#42cf3f\",\"scaleX\":0.5,\"scaleY\":0.5,\"angle\":12.72,\"text\":\"Lorem ipsum dolor sit amet,\\nconsectetur adipisicing elit,\\nsed do eiusmod tempor incididunt\\nut labore et dolore magna al\",\"fontWeight\":\"\",\"fontFamily\":\"helvetica\",\"styles\":{}},{\"type\":\"circle\",\"version\":\"3.6.3\",\"left\":0,\"top\":127,\"width\":100,\"height\":100,\"fill\":\"#9e4b3c\",\"opacity\":0.8,\"radius\":50,\"startAngle\":0,\"endAngle\":6.283185307179586},{\"type\":\"rect\",\"version\":\"3.6.3\",\"left\":530,\"top\":16,\"width\":50,\"height\":50,\"fill\":\"#a209e7\",\"opacity\":0.8},{\"type\":\"triangle\",\"version\":\"3.6.3\",\"left\":88,\"top\":211,\"width\":50,\"height\":50,\"fill\":\"#20286e\",\"opacity\":0.8},{\"type\":\"line\",\"version\":\"3.6.3\",\"left\":27,\"top\":237,\"width\":150,\"height\":100,\"stroke\":\"#5e9fb3\",\"x1\":-75,\"x2\":75,\"y1\":-50,\"y2\":50},{\"type\":\"circle\",\"version\":\"3.6.3\",\"left\":371,\"top\":447,\"width\":100,\"height\":100,\"fill\":\"#5ec5ba\",\"opacity\":0.8,\"radius\":50,\"startAngle\":0,\"endAngle\":6.283185307179586},{\"type\":\"i-text\",\"version\":\"3.6.3\",\"left\":376,\"top\":444,\"width\":493.52,\"height\":150.06,\"fill\":\"#ecb2cc\",\"scaleX\":0.5,\"scaleY\":0.5,\"angle\":-1,\"text\":\"Lorem ipsum dolor sit amet,\\nconsectetur adipisicing elit,\\nsed do ei\",\"fontWeight\":\"\",\"fontFamily\":\"helvetica\",\"styles\":{}},{\"type\":\"rect\",\"version\":\"3.6.3\",\"left\":492,\"top\":505,\"width\":50,\"height\":50,\"fill\":\"#9fa139\",\"opacity\":0.8},{\"type\":\"triangle\",\"version\":\"3.6.3\",\"left\":559,\"top\":527,\"width\":50,\"height\":50,\"fill\":\"#d5eb95\",\"opacity\":0.8},{\"type\":\"triangle\",\"version\":\"3.6.3\",\"left\":566,\"top\":90,\"width\":50,\"height\":50,\"fill\":\"#d3d188\",\"opacity\":0.8},{\"type\":\"polygon\",\"version\":\"3.6.3\",\"left\":834.66,\"top\":241.24,\"width\":385,\"height\":245,\"fill\":\"#9580bf\",\"scaleX\":0.68,\"scaleY\":0.68,\"angle\":140,\"points\":[{\"x\":185,\"y\":0},{\"x\":250,\"y\":100},{\"x\":385,\"y\":170},{\"x\":0,\"y\":245}]},{\"type\":\"rect\",\"version\":\"3.6.3\",\"left\":643,\"top\":16,\"width\":50,\"height\":50,\"fill\":\"#c1b138\",\"scaleX\":2.64,\"scaleY\":2.64,\"opacity\":0.8},{\"type\":\"text\",\"version\":\"3.6.3\",\"left\":389,\"top\":360,\"width\":22.25,\"height\":45.2,\"fill\":\"#d6a02d\",\"scaleX\":0.5,\"scaleY\":0.5,\"text\":\"L\",\"fontWeight\":\"\",\"fontFamily\":\"helvetica\",\"styles\":{}},{\"type\":\"triangle\",\"version\":\"3.6.3\",\"left\":625,\"top\":350,\"width\":50,\"height\":50,\"fill\":\"#908f9f\",\"opacity\":0.8},{\"type\":\"circle\",\"version\":\"3.6.3\",\"left\":603,\"top\":454,\"width\":100,\"height\":100,\"fill\":\"#578b25\",\"opacity\":0.8,\"radius\":50,\"startAngle\":0,\"endAngle\":6.283185307179586},{\"type\":\"circle\",\"version\":\"3.6.3\",\"left\":681,\"top\":388,\"width\":100,\"height\":100,\"fill\":\"#990621\",\"opacity\":0.8,\"radius\":50,\"startAngle\":0,\"endAngle\":6.283185307179586},{\"type\":\"circle\",\"version\":\"3.6.3\",\"left\":676,\"top\":491,\"width\":100,\"height\":100,\"fill\":\"#c2d944\",\"opacity\":0.8,\"radius\":50,\"startAngle\":0,\"endAngle\":6.283185307179586},{\"type\":\"circle\",\"version\":\"3.6.3\",\"left\":644,\"top\":53,\"width\":100,\"height\":100,\"fill\":\"#c1532e\",\"opacity\":0.8,\"radius\":50,\"startAngle\":0,\"endAngle\":6.283185307179586},{\"type\":\"triangle\",\"version\":\"3.6.3\",\"left\":601,\"top\":434,\"width\":50,\"height\":50,\"fill\":\"#54cd04\",\"opacity\":0.8},{\"type\":\"line\",\"version\":\"3.6.3\",\"left\":435,\"top\":198,\"width\":150,\"height\":100,\"stroke\":\"#d08d13\",\"x1\":-75,\"x2\":75,\"y1\":-50,\"y2\":50},{\"type\":\"rect\",\"version\":\"3.6.3\",\"left\":101,\"top\":12,\"width\":50,\"height\":50,\"fill\":\"#7a7d9c\",\"opacity\":0.8},{\"type\":\"rect\",\"version\":\"3.6.3\",\"left\":14,\"top\":7,\"width\":50,\"height\":50,\"fill\":\"#16c0ef\",\"opacity\":0.8},{\"type\":\"rect\",\"version\":\"3.6.3\",\"left\":22,\"top\":74.17,\"width\":50,\"height\":50,\"fill\":\"#8a4cde\",\"angle\":355.3,\"opacity\":0.8}]}, function() {\ninitMinimap();\nupdateMiniMapVP();\n});</p>\n<p>  function createCanvasEl() {\nvar designSize = { width: 800, height: 600 };\nvar originalVPT = design.viewportTransform;\n// zoom to fit the design in the display canvas\nvar designRatio = fabric.util.findScaleToFit(designSize, design);</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// zoom to fit the display the design in the minimap.\nvar minimapRatio = fabric.util.findScaleToFit(design, minimap);\n\nvar scaling = minimap.getRetinaScaling();\n\nvar finalWidth =  designSize.width * designRatio;\nvar finalHeight =  designSize.height * designRatio;\n\ndesign.viewportTransform = [\n  designRatio, 0, 0, designRatio,\n  (design.getWidth() - finalWidth) / 2,\n  (design.getHeight() - finalHeight) / 2\n];\nvar canvas = design.toCanvasElement(minimapRatio * scaling);\ndesign.viewportTransform = originalVPT;\nreturn canvas;</code></pre></div>\n<p>  }</p>\n<p>  function updateMiniMap() {\nvar canvas = createCanvasEl();\nminimap.backgroundImage._element = canvas;\nminimap.requestRenderAll();\n}</p>\n<p>  function updateMiniMapVP() {\nvar designSize = { width: 800, height: 600 };\nvar rect = minimap.getObjects()[0];\nvar designRatio = fabric.util.findScaleToFit(designSize, design);\nvar totalRatio = fabric.util.findScaleToFit(designSize, minimap);\nvar finalRatio = designRatio / design.getZoom();\nrect.scaleX = finalRatio;\nrect.scaleY = finalRatio;\nrect.top = minimap.backgroundImage.top - design.viewportTransform[5] * totalRatio / design.getZoom();\nrect.left = minimap.backgroundImage.left - design.viewportTransform[4] * totalRatio / design.getZoom();\nminimap.requestRenderAll();\n}</p>\n<p>  function initMinimap() {\nvar canvas = createCanvasEl();\nvar backgroundImage = new fabric.Image(canvas);\nbackgroundImage.scaleX = 1 / design.getRetinaScaling();\nbackgroundImage.scaleY = 1 / design.getRetinaScaling();\nminimap.centerObject(backgroundImage);\nminimap.backgroundColor = 'white';\nminimap.backgroundImage = backgroundImage;\nminimap.requestRenderAll();\nvar minimapView = new fabric.Rect({\ntop: backgroundImage.top,\nleft: backgroundImage.left,\nwidth: backgroundImage.width / design.getRetinaScaling(),\nheight: backgroundImage.height/ design.getRetinaScaling(),\nfill: 'rgba(0, 0, 255, 0.3)',\ncornerSize: 6,\ntransparentCorners: false,\ncornerColor: 'blue',\nstrokeWidth: 0,\n});\nminimapView.controls = {\nbr: fabric.Object.prototype.controls.br,\n};\nminimap.add(minimapView);\n}</p>\n<p>  var debouncedMiniMap = _.debounce(updateMiniMap, 250);</p>\n<p>  design.on('object:modified', function() {\nupdateMiniMap();\n})</p>\n<p>// hook up the pan and zoom\ndesign.on('mouse:wheel', function(opt) {\nvar delta = opt.e.deltaY;\nvar zoom = design.getZoom();\nzoom *= 0.999 ** delta;\nif (zoom > 20) zoom = 20;\nif (zoom &#x3C; 0.01) zoom = 0.01;\nthis.setZoom(zoom);\nupdateMiniMapVP();\nopt.e.preventDefault();\nopt.e.stopPropagation();\n});\ndesign.on('mouse:down', function(opt) {\nvar evt = opt.e;\nif (evt.altKey === true) {\nthis.isDragging = true;\nthis.selection = false;\nthis.lastPosX = evt.clientX;\nthis.lastPosY = evt.clientY;\n}\n});\ndesign.on('mouse:move', function(opt) {\nif (this.isDragging) {\nvar e = opt.e;\nvar vpt = this.viewportTransform;\nvpt[4] += e.clientX - this.lastPosX;\nvpt[5] += e.clientY - this.lastPosY;\nthis.requestRenderAll();\nupdateMiniMapVP();\nthis.lastPosX = e.clientX;\nthis.lastPosY = e.clientY;\n}\n});\ndesign.on('mouse:up', function(opt) {\nthis.isDragging = false;\nthis.selection = true;\n});</p>\n</pre>\n</div>","frontmatter":{"title":"Build a minimap for canvas"},"mdFile":{"__typename":"File","relativePath":"demo/minimap-for-canvas/index.md"}}},"pageContext":{"slug":"/demo/minimap-for-canvas","prev":{"title":"Animation easing","slug":"/demo/animation-easing"},"next":{"title":"Clipping and masking","slug":"/demo/clipping"}}}}